<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Saaati — Login</title>
<style>
:root{--bg:#f6f8fb;--card:#fff;--ink:#0f172a;--muted:#475569;--line:#e2e8f0;--accent:#3b82f6;--ok:#16a34a;--warn:#ef4444}
.dark{--bg:#0b1020;--card:#0e1528;--ink:#e5e7eb;--muted:#94a3b8;--line:#1f2b40;--accent:#60a5fa}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,"Noto Naskh Arabic",Tahoma,Arial,sans-serif}
.topbar{position:sticky;top:0;background:#ffffffcc;backdrop-filter:blur(6px);border-bottom:1px solid var(--line)}
.dark .topbar{background:#0c1426cc}
.topbar .inner{max-width:880px;margin:0 auto;padding:10px 12px;display:flex;align-items:center;gap:8px}
.brand{font-weight:800;display:flex;align-items:center;gap:6px}
.spacer{flex:1}
.btn-sm{padding:6px 10px;border-radius:10px;border:1px solid var(--line);background:var(--card);color:var(--ink);cursor:pointer;height:36px}
.flags{display:flex;gap:6px}
.flag{width:36px;height:36px;padding:0;border-radius:10px;font-size:18px}
.flag.active{outline:2px solid var(--accent)}
.wrap{min-height:calc(100dvh - 60px);display:grid;place-items:center;padding:24px}
.card{width:100%;max-width:560px;background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 26px rgba(15,23,42,.08);padding:18px}
h1{margin:4px 0 10px;font-size:22px}
p.small{margin:0 0 14px;color:var(--muted)}
.tabs{display:flex;gap:8px;margin-bottom:10px}
.tab{flex:1;text-align:center;padding:10px;border:1px solid var(--line);background:var(--card);border-radius:10px;cursor:pointer}
.tab.active{border-color:var(--accent);box-shadow:0 0 0 2px color-mix(in srgb,var(--accent),transparent 75%) inset}
.grid{display:grid;gap:10px}
label{font-size:13px;color:var(--muted);display:block;margin:0 0 4px}
input{width:100%;height:44px;border:1px solid var(--line);border-radius:12px;background:#fff;color:#0f172a;padding:10px}
.dark input{background:#0a1222;color:#e5e7eb;border-color:#1f2b40}
.actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
.btn{padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:var(--card);cursor:pointer}
.btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
.btn.google{display:flex;align-items:center;gap:8px}
.note{font-size:12px;color:var(--muted);margin-top:8px}
.err{background:color-mix(in srgb, var(--warn), #fff 85%);color:#7f1d1d;border:1px solid #fecaca;padding:10px;border-radius:10px;display:none}
.ok{background:color-mix(in srgb, var(--ok), #fff 85%);color:#14532d;border:1px solid #86efac;padding:10px;border-radius:10px;display:none}
.link{background:none;border:0;color:var(--accent);cursor:pointer;padding:0}
.center{display:flex;justify-content:center}
</style>
</head>
<body>
<!-- Top -->
<div class="topbar">
  <div class="inner">
    <div class="brand">⏱️ <span id="brandTxt">ساعتي</span></div>
    <div class="spacer"></div>
    <button id="themeBtn" class="btn-sm">داكن</button>
    <div class="flags">
      <button class="btn-sm flag" data-lang="ar" title="العربية">🇸🇦</button>
      <button class="btn-sm flag" data-lang="en" title="English">🇬🇧</button>
      <button class="btn-sm flag" data-lang="de" title="Deutsch">🇩🇪</button>
    </div>
  </div>
</div>

<div class="wrap">
  <div class="card">
    <h1 id="title">تسجيل الدخول</h1>
    <p id="hint" class="small">سجّل دخولك أو أنشئ حسابًا جديدًا لمزامنة بياناتك عبر الأجهزة.</p>

    <div class="tabs">
      <div id="tabLogin" class="tab active">دخول</div>
      <div id="tabSignup" class="tab">إنشاء حساب</div>
    </div>

    <!-- Alerts -->
    <div id="alertErr" class="err"></div>
    <div id="alertOk"  class="ok"></div>

    <div class="grid" id="formArea">
      <div>
        <label id="lblEmail">البريد الإلكتروني</label>
        <input id="email" type="email" autocomplete="email" />
      </div>
      <div>
        <label id="lblPass">كلمة المرور</label>
        <input id="password" type="password" autocomplete="current-password" />
      </div>
      <div id="nameWrap" style="display:none">
        <label id="lblName">الاسم المعروض (اختياري)</label>
        <input id="displayName" type="text" autocomplete="name" />
      </div>

      <div class="actions">
        <button id="submitBtn" class="btn primary">دخول</button>
        <button id="googleBtn" class="btn google" type="button">
          <img alt="" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" height="18"> Google
        </button>
        <button id="skipBtn" class="btn" type="button">تخطي الآن</button>
        <button id="resetBtn" class="btn link" type="button">نسيت كلمة المرور؟</button>
      </div>

      <div class="note" id="legal">بتسجيلك، أنت توافق على شروط الخصوصية.</div>
      <div class="center note"><a id="backApp" href="index.html">← العودة للتطبيق</a></div>
    </div>
  </div>
</div>

<!-- Firebase SDK (modules) -->
<script type="module">
/* ================= I18N ================= */
const I18N={
  ar:{dir:'rtl',brand:'ساعتي',themeDark:'فاتح',themeLight:'داكن',
      titleIn:'تسجيل الدخول',titleUp:'إنشاء حساب',hint:'سجّل دخولك أو أنشئ حسابًا لمزامنة بياناتك عبر الأجهزة.',
      tabs:{in:'دخول',up:'إنشاء حساب'},
      email:'البريد الإلكتروني', pass:'كلمة المرور', name:'الاسم المعروض (اختياري)',
      btnIn:'دخول', btnUp:'إنشاء حساب', btnGoogle:'دخول Google', btnSkip:'تخطي الآن', reset:'نسيت كلمة المرور؟',
      okIn:'تم تسجيل الدخول بنجاح ✅', okUp:'تم إنشاء الحساب ✅',
      errReq:'يرجى إدخال البريد وكلمة المرور.', resetSent:'تم إرسال رابط إعادة التعيين (إن وُجد حساب).'},
  en:{dir:'ltr',brand:'Saaati',themeDark:'Light',themeLight:'Dark',
      titleIn:'Sign in',titleUp:'Create account',hint:'Sign in or create a new account to sync your data across devices.',
      tabs:{in:'Sign in',up:'Sign up'},
      email:'Email', pass:'Password', name:'Display name (optional)',
      btnIn:'Sign in', btnUp:'Create account', btnGoogle:'Sign in with Google', btnSkip:'Skip for now', reset:'Forgot password?',
      okIn:'Signed in successfully ✅', okUp:'Account created ✅',
      errReq:'Please enter email and password.', resetSent:'Password reset email sent (if account exists).'},
  de:{dir:'ltr',brand:'Meine Stunden',themeDark:'Hell',themeLight:'Dunkel',
      titleIn:'Anmelden',titleUp:'Konto erstellen',hint:'Melden Sie sich an oder erstellen Sie ein Konto, um Daten zu synchronisieren.',
      tabs:{in:'Anmelden',up:'Registrieren'},
      email:'E-Mail', pass:'Passwort', name:'Anzeigename (optional)',
      btnIn:'Anmelden', btnUp:'Konto erstellen', btnGoogle:'Mit Google anmelden', btnSkip:'Überspringen', reset:'Passwort vergessen?',
      okIn:'Erfolgreich angemeldet ✅', okUp:'Konto erstellt ✅',
      errReq:'Bitte E-Mail und Passwort eingeben.', resetSent:'E-Mail zum Zurücksetzen gesendet (falls Konto vorhanden).'}
};
const LS_LANG='saaati_lang';
let lang = localStorage.getItem(LS_LANG) || (navigator.language?.startsWith('ar')?'ar':navigator.language?.startsWith('de')?'de':'en');

/* ============== UI refs ============== */
const title=document.getElementById('title');
const hint=document.getElementById('hint');
const brandTxt=document.getElementById('brandTxt');
const themeBtn=document.getElementById('themeBtn');
const tabs={in:document.getElementById('tabLogin'), up:document.getElementById('tabSignup')};
const labels={email:document.getElementById('lblEmail'), pass:document.getElementById('lblPass'), name:document.getElementById('lblName')};
const inputs={email:document.getElementById('email'), pass:document.getElementById('password'), name:document.getElementById('displayName')};
const nameWrap=document.getElementById('nameWrap');
const submitBtn=document.getElementById('submitBtn');
const googleBtn=document.getElementById('googleBtn');
const skipBtn=document.getElementById('skipBtn');
const resetBtn=document.getElementById('resetBtn');
const alertErr=document.getElementById('alertErr');
const alertOk=document.getElementById('alertOk');

/* ============== Lang apply ============== */
function setFlagActive(v){document.querySelectorAll('.flag').forEach(b=>b.classList.toggle('active',b.dataset.lang===v));}
function applyLang(){
  const L=I18N[lang];
  document.documentElement.lang=lang; document.documentElement.dir=L.dir; document.body.dir=L.dir;
  brandTxt.textContent=L.brand;
  themeBtn.textContent=document.body.classList.contains('dark')?L.themeDark:L.themeLight;
  title.textContent=mode==='in'?L.titleIn:L.titleUp; hint.textContent=L.hint;
  tabs.in.textContent=L.tabs.in; tabs.up.textContent=L.tabs.up;
  labels.email.textContent=L.email; labels.pass.textContent=L.pass; labels.name.textContent=L.name;
  submitBtn.textContent=mode==='in'?L.btnIn:L.btnUp;
  googleBtn.lastChild.nodeValue = ' ' + L.btnGoogle;
  skipBtn.textContent=L.btnSkip; resetBtn.textContent=L.reset;
  setFlagActive(lang);
  localStorage.setItem(LS_LANG,lang);
}

/* ============== Theme ============== */
themeBtn.onclick=()=>{document.body.classList.toggle('dark'); applyLang();};

/* ============== Mode (login/signup) ============== */
let mode='in'; // 'in' or 'up'
function setMode(m){
  mode=m;
  nameWrap.style.display = (m==='up')?'block':'none';
  tabs.in.classList.toggle('active',m==='in');
  tabs.up.classList.toggle('active',m==='up');
  applyLang();
  hideAlerts();
}
tabs.in.onclick=()=>setMode('in');
tabs.up.onclick=()=>setMode('up');

/* ============== Alerts ============== */
function showErr(msg){alertErr.textContent=msg; alertErr.style.display='block'; alertOk.style.display='none';}
function showOk(msg){alertOk.textContent=msg; alertOk.style.display='block'; alertErr.style.display='none';}
function hideAlerts(){alertErr.style.display='none'; alertOk.style.display='none';}

/* ============== Flags ============== */
document.querySelectorAll('.flag').forEach(b=> b.addEventListener('click', ()=>{lang=b.dataset.lang; applyLang();}));

/* ============== Firebase ============== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import {
  getAuth, setPersistence, browserLocalPersistence, onAuthStateChanged,
  signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile,
  GoogleAuthProvider, signInWithPopup, sendPasswordResetEmail
} from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";

/* 🔑 استخدم نفس الإعدادات التي أنشأتها في مشروعك */
const firebaseConfig = {
  apiKey: "AIzaSyBpzQ4GRDzdYCuMvsj3rrWN8Ck0GLHiB2g",
  authDomain: "saaati-pro.firebaseapp.com",
  projectId: "saaati-pro",
  storageBucket: "saaati-pro.firebasestorage.app",
  messagingSenderId: "719485178559",
  appId: "1:719485178559:web:56460b57bb0560d8496c0a",
  measurementId: "G-2KBHPQP07X"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
await setPersistence(auth, browserLocalPersistence);

/* إن كان المستخدم مسجلاً بالفعل، ادخل مباشرة للصفحة الأساسية */
onAuthStateChanged(auth, (user)=>{
  if(user){ location.href = "index.html"; }
});

/* ============== Actions ============== */
async function handleSubmit(){
  hideAlerts();
  const email=inputs.email.value.trim();
  const pass =inputs.pass.value.trim();
  const name =inputs.name.value.trim();
  if(!email || !pass){ return showErr(I18N[lang].errReq); }

  try{
    if(mode==='in'){
      await signInWithEmailAndPassword(auth, email, pass);
      showOk(I18N[lang].okIn);
      setTimeout(()=>location.href="index.html", 400);
    }else{
      const cred = await createUserWithEmailAndPassword(auth, email, pass);
      if(name) await updateProfile(cred.user, { displayName:name });
      showOk(I18N[lang].okUp);
      setTimeout(()=>location.href="index.html", 400);
    }
  }catch(err){
    showErr(`Firebase: ${err.code || err.message}`);
  }
}
submitBtn.onclick = handleSubmit;

googleBtn.onclick = async ()=>{
  hideAlerts();
  try{
    const provider = new GoogleAuthProvider();
    await signInWithPopup(auth, provider);
    showOk(I18N[lang].okIn);
    setTimeout(()=>location.href="index.html", 300);
  }catch(err){
    showErr(`Google: ${err.code || err.message}`);
  }
};

resetBtn.onclick = async ()=>{
  hideAlerts();
  const email=inputs.email.value.trim();
  if(!email){ return showErr(I18N[lang].email + ' ?'); }
  try{
    await sendPasswordResetEmail(auth, email);
    showOk(I18N[lang].resetSent);
  }catch(err){
    showErr(`Reset: ${err.code || err.message}`);
  }
};

/* تخطي بدون حساب (اختياري) */
skipBtn.onclick = ()=>{ location.href = "index.html"; };

/* ============== Init ============== */
applyLang();
</script>
</body>
</html>
