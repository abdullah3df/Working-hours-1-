<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <title>Saaati — Sign In</title>
  <style>
    :root{--bg:#f6f8fb;--card:#fff;--ink:#0f172a;--muted:#475569;--line:#e2e8f0;--accent:#3b82f6}
    .dark{--bg:#0b1020;--card:#0e1528;--ink:#e5e7eb;--muted:#94a3b8;--line:#1f2b40;--accent:#60a5fa}
    *{box-sizing:border-box}
    body{
      margin:0;background:var(--bg);color:var(--ink);
      font-family:system-ui,"Noto Naskh Arabic","Cairo",Tahoma,Arial,sans-serif;
      min-height:100vh;display:flex;flex-direction:column;
    }

    /* Topbar */
    .topbar{position:sticky;top:0;z-index:10;background:color-mix(in srgb, var(--card) 92%, transparent);backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
    .dark .topbar{background:#0c1426cc}
    .topbar .inner{max-width:960px;margin:0 auto;padding:8px 12px;display:flex;align-items:center;gap:8px;min-height:52px}
    .brand{font-weight:800;display:flex;align-items:center;gap:6px;white-space:nowrap}
    .spacer{flex:1}
    .btn-sm{height:36px;padding:6px 10px;border-radius:10px;border:1px solid var(--line);background:var(--card);color:var(--ink);cursor:pointer}
    .icon-btn{width:36px;height:36px;display:inline-flex;align-items:center;justify-content:center;padding:0;font-size:18px}

    /* Language dropdown */
    .lang-wrap{position:relative}
    #langBtn{display:inline-flex;align-items:center;gap:6px}
    #langLabel{font-weight:700;font-size:13px}
    #langMenu{
      position:absolute; top:44px; inset-inline-end:0; min-width:160px;
      background:var(--card); border:1px solid var(--line); border-radius:12px;
      box-shadow:0 12px 28px rgba(15,23,42,.16); padding:6px; display:none; z-index:100;
    }
    #langMenu.open{display:block}
    .lang-opt{width:100%; text-align:start; padding:8px 10px; border-radius:10px; border:1px solid transparent; background:transparent; cursor:pointer}
    .lang-opt:hover{background:color-mix(in srgb, var(--line) 16%, transparent)}
    .lang-opt[data-active="true"]{background:color-mix(in srgb, var(--accent) 12%, transparent); border-color:color-mix(in srgb, var(--accent) 25%, transparent)}
    .lang-opt kbd{opacity:.7; font-size:12px}

    /* Page content */
    .center{flex:1;display:flex;align-items:center;justify-content:center;padding:16px}
    .card{
      background:var(--card); border:1px solid var(--line); border-radius:16px;
      box-shadow:0 8px 26px rgba(15,23,42,.06);
      padding:20px; max-width:380px; width:100%; text-align:center;
    }
    h2{margin:0 0 6px}
    p.desc{margin:0 0 12px; color:var(--muted)}

    .field{margin:8px 0; text-align:start}
    .field label{display:block; font-size:13px; color:var(--muted); margin-bottom:4px}
    .input{
      width:100%; padding:10px; border-radius:10px; border:1px solid var(--line);
      background:#fff; color:#0f172a; text-align:start; font-size:15px;
    }
    .dark .input{background:#0a1222; color:#e5e7eb; border-color:#1f2b40}

    .btn{width:100%; padding:10px; margin-top:8px; border-radius:10px; border:1px solid var(--line); cursor:pointer; font-weight:700}
    .btn-primary{background:var(--accent); color:#fff; border-color:transparent}
    .btn-primary:hover{filter:brightness(.95)}
    .btn-ghost{background:var(--card)}
    .btn-google{background:#fff; display:flex; align-items:center; justify-content:center; gap:6px}
    .btn-google img{width:18px; height:18px}
    .dark .btn-google{background:#0a1222; border-color:#1f2b40}

    .error{background:#fee2e2; color:#991b1b; border-radius:10px; padding:8px; margin:8px 0; font-size:14px; display:none}
    .small{font-size:13px; color:var(--muted)}
    .footer-link{margin-top:12px; font-size:13px}
    .footer-link a{color:var(--accent); text-decoration:none}

    @media (max-width:420px){
      .btn{padding:9px}
      .input{padding:9px}
    }
  </style>
</head>
<body>

  <!-- Top bar -->
  <div class="topbar">
    <div class="inner">
      <div class="brand">⏱️ <span id="brandTxt">Saaati</span></div>
      <div class="spacer"></div>

      <!-- Language dropdown -->
      <div class="lang-wrap">
        <button id="langBtn" class="btn-sm" aria-haspopup="true" aria-expanded="false" title="Language">
          🌐 <span id="langLabel">EN</span>
        </button>
        <div id="langMenu" role="menu" aria-label="Select language">
          <button class="lang-opt" data-lang="en"><strong>English</strong> <kbd>EN</kbd></button>
          <button class="lang-opt" data-lang="ar"><strong>العربية</strong> <kbd>AR</kbd></button>
          <button class="lang-opt" data-lang="de"><strong>Deutsch</strong> <kbd>DE</kbd></button>
        </div>
      </div>

      <!-- Theme -->
      <button id="themeBtn" class="btn-sm icon-btn" aria-label="Toggle theme">🌙</button>
    </div>
  </div>

  <!-- Content -->
  <div class="center">
    <div class="card" id="authCard">
      <h2 id="title">Sign in</h2>
      <p id="subtitle" class="desc">Sign in or create an account to sync your data across devices.</p>

      <div id="errorBox" class="error"></div>

      <div class="field">
        <label id="lblEmail" for="email">Email</label>
        <input id="email" type="email" class="input" placeholder="you@example.com" />
      </div>

      <div class="field">
        <label id="lblPassword" for="password">Password</label>
        <input id="password" type="password" class="input" placeholder="••••••••" />
      </div>

      <button id="loginBtn" class="btn btn-primary">Sign in</button>
      <button id="signupBtn" class="btn btn-ghost">Create new account</button>
      <button id="googleBtn" class="btn btn-google">
        <img src="https://www.svgrepo.com/show/475656/google-color.svg" alt="Google" />
        <span id="btnGoogleText">Continue with Google</span>
      </button>
      <button id="skipBtn" class="btn btn-ghost">Skip for now</button>

      <p class="footer-link"><a id="backToApp" href="index.html">← Back to app</a></p>
    </div>
  </div>

  <!-- Firebase + App -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import {
      getAuth,
      setPersistence,
      browserLocalPersistence,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      GoogleAuthProvider,
      signInWithPopup,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

    /* ===== Firebase config (لا تغيّره) ===== */
    const firebaseConfig = {
      apiKey: "AIzaSyBpzQ4GRDzdYCuMvsj3rrWN8Ck0GLHiB2g",
      authDomain: "saaati-pro.firebaseapp.com",
      projectId: "saaati-pro",
      storageBucket: "saaati-pro.firebasestorage.app",
      messagingSenderId: "719485178559",
      appId: "1:719485178559:web:56460b57bb0560d8496c0a",
      measurementId: "G-2KBHPQP07X"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    await setPersistence(auth, browserLocalPersistence);
    const provider = new GoogleAuthProvider();

    /* ===== I18N ===== */
    const I18N = {
      en: {
        dir:'ltr', brand:'Saaati',
        title:'Sign in',
        subtitle:'Sign in or create an account to sync your data across devices.',
        email:'Email', password:'Password',
        login:'Sign in', signup:'Create new account',
        google:'Continue with Google', skip:'Skip for now',
        back:'← Back to app',
        errors:{login:'Sign-in error: ', signup:'Sign-up error: ', google:'Google sign-in error: '}
      },
      ar: {
        dir:'rtl', brand:'ساعتي',
        title:'تسجيل الدخول',
        subtitle:'سجّل دخولك أو أنشئ حسابًا جديدًا لمزامنة بياناتك عبر الأجهزة.',
        email:'البريد الإلكتروني', password:'كلمة المرور',
        login:'دخول', signup:'إنشاء حساب جديد',
        google:'دخول باستخدام Google', skip:'تخطي الآن',
        back:'← العودة للتطبيق',
        errors:{login:'خطأ في تسجيل الدخول: ', signup:'خطأ في إنشاء الحساب: ', google:'خطأ في تسجيل الدخول بـ Google: '}
      },
      de: {
        dir:'ltr', brand:'Meine Stunden',
        title:'Anmelden',
        subtitle:'Melde dich an oder erstelle ein Konto, um deine Daten zu synchronisieren.',
        email:'E-Mail', password:'Passwort',
        login:'Anmelden', signup:'Neues Konto erstellen',
        google:'Mit Google fortfahren', skip:'Jetzt überspringen',
        back:'← Zur App',
        errors:{login:'Anmeldefehler: ', signup:'Registrierungsfehler: ', google:'Google-Anmeldefehler: '}
      }
    };

    const LS_LANG = 'saaati_lang';
    let currentLang = localStorage.getItem(LS_LANG) || 'en';

    /* ===== Refs ===== */
    const themeBtn = document.getElementById('themeBtn');
    const langBtn  = document.getElementById('langBtn');
    const langMenu = document.getElementById('langMenu');
    const langLabel= document.getElementById('langLabel');

    const brandTxt = document.getElementById('brandTxt');
    const title    = document.getElementById('title');
    const subtitle = document.getElementById('subtitle');
    const lblEmail = document.getElementById('lblEmail');
    const lblPassword = document.getElementById('lblPassword');
    const loginBtn = document.getElementById('loginBtn');
    const signupBtn= document.getElementById('signupBtn');
    const googleBtn= document.getElementById('googleBtn');
    const btnGoogleText = document.getElementById('btnGoogleText');
    const skipBtn  = document.getElementById('skipBtn');
    const backToApp= document.getElementById('backToApp');

    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const errorBox = document.getElementById('errorBox');

    /* ===== Theme ===== */
    function setThemeIcon(){
      const isDark = document.body.classList.contains('dark');
      themeBtn.textContent = isDark ? '☀️' : '🌙';
      themeBtn.setAttribute('aria-label', isDark ? 'Switch to Light' : 'Switch to Dark');
    }
    themeBtn.onclick = ()=>{ document.body.classList.toggle('dark'); setThemeIcon(); };

    /* ===== Language ===== */
    function updateLangLabel(){
      langLabel.textContent = (currentLang==='ar'?'AR' : currentLang==='de'?'DE' : 'EN');
    }
    function setLang(lang){
      currentLang = lang;
      const L = I18N[lang] || I18N.en;
      document.documentElement.lang = lang;
      document.documentElement.dir  = L.dir;
      document.body.dir = L.dir;

      brandTxt.textContent = L.brand;
      title.textContent    = L.title;
      subtitle.textContent = L.subtitle;
      lblEmail.textContent = L.email;
      lblPassword.textContent = L.password;
      loginBtn.textContent = L.login;
      signupBtn.textContent= L.signup;
      btnGoogleText.textContent = L.google;
      skipBtn.textContent  = L.skip;
      backToApp.textContent= L.back;

      localStorage.setItem(LS_LANG, lang);
      updateLangLabel();
      setThemeIcon();
    }

    // فتح/إغلاق قائمة اللغة + منع الفقاعة
    langBtn.addEventListener('click',(e)=>{ e.stopPropagation(); const willOpen=!langMenu.classList.contains('open'); langMenu.classList.toggle('open', willOpen); langBtn.setAttribute('aria-expanded', String(willOpen)); });
    langMenu.addEventListener('click',(e)=>{ e.stopPropagation(); });
    window.addEventListener('click',(e)=>{ if(!langMenu.contains(e.target) && !langBtn.contains(e.target)){ langMenu.classList.remove('open'); langBtn.setAttribute('aria-expanded','false'); }});
    window.addEventListener('keydown',(e)=>{ if(e.key==='Escape'){ langMenu.classList.remove('open'); langBtn.setAttribute('aria-expanded','false'); }});
    langMenu.querySelectorAll('.lang-opt').forEach(opt=>{
      opt.addEventListener('click', ()=>{
        const lang = opt.dataset.lang;
        setLang(lang);
        langMenu.querySelectorAll('.lang-opt').forEach(o=>o.dataset.active=(o.dataset.lang===lang)?'true':'false');
        langMenu.classList.remove('open');
        langBtn.setAttribute('aria-expanded','false');
      });
    });

    /* ===== Auth actions ===== */
    function showError(msg){
      errorBox.textContent = msg;
      errorBox.style.display = 'block';
      setTimeout(()=> errorBox.style.display='none', 4500);
    }

    loginBtn.onclick = async ()=>{
      try{
        const email = emailInput.value.trim();
        const pass  = passwordInput.value.trim();
        await signInWithEmailAndPassword(auth, email, pass);
        window.location.href = 'index.html';
      }catch(err){
        const L = I18N[currentLang] || I18N.en;
        showError(L.errors.login + err.code);
      }
    };

    signupBtn.onclick = async ()=>{
      try{
        const email = emailInput.value.trim();
        const pass  = passwordInput.value.trim();
        await createUserWithEmailAndPassword(auth, email, pass);
        alert('✅');
        window.location.href = 'index.html';
      }catch(err){
        const L = I18N[currentLang] || I18N.en;
        showError(L.errors.signup + err.code);
      }
    };

    const providerGoogle = provider; // alias
    googleBtn.onclick = async ()=>{
      try{
        await signInWithPopup(auth, providerGoogle);
        window.location.href = 'index.html';
      }catch(err){
        const L = I18N[currentLang] || I18N.en;
        showError(L.errors.google + err.code);
      }
    };

    skipBtn.onclick = ()=>{ window.location.href = 'index.html'; };

    // لو المستخدم مسجل أصلًا، دخّله مباشرة للتطبيق
    onAuthStateChanged(auth, (user)=>{
      if(user) window.location.href = 'index.html';
    });

    /* ===== Init ===== */
    (function init(){
      // لغة افتراضية EN عند أول زيارة
      if(!localStorage.getItem(LS_LANG)){ localStorage.setItem(LS_LANG,'en'); currentLang='en'; }
      setLang(currentLang);
      setThemeIcon();
    })();
  </script>
</body>
</html>
